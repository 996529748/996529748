Object.defineProperty(exports,"__esModule",{value:!0}),exports.Interceptors=void 0;var _createClass=function(){function t(e,s){for(var a=0;a<s.length;a++){var t=s[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,s,a){return s&&t(e.prototype,s),a&&t(e,a),e}}(),_axios=require("axios"),_axios2=_interopRequireDefault(_axios),_utils=require("@foxit/utils"),_utils2=_interopRequireDefault(_utils);require("element-ui/lib/theme-chalk/index.css");var _elementUi=require("element-ui"),_vant=require("vant"),_config=require("./config");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var requestCount=0,loadingInstance=void 0,loadingInstanceArr=[],deviceType=_utils2.default.browse.deviceType(),Interceptors=exports.Interceptors=function(){function s(e){_classCallCheck(this,s),this.instance=_axios2.default.create(e),this.init()}return _createClass(s,[{key:"init",value:function(){this.instance.interceptors.request.use(function(e){return e.headers.showLoading&&("pc"===deviceType?(loadingInstance=_elementUi.Loading.service(e.headers.loadingConfig),loadingInstanceArr.push(loadingInstance)):_vant.Toast.loading(),requestCount+=1),e.formData&&(e.data=e.formData),e},function(e){return _config.config.showLoading&&--requestCount,Promise.reject(e)}),this.instance.interceptors.response.use(function(e){if(e.config.headers.showLoading&&--requestCount,loadingClose(),200===e.status||201===e.status)switch(e.data.ret){case 400:case 500:return Promise.reject(e.data.msg);default:return e.data}return e.data},function(e){if(e.config.headers.showLoading&&--requestCount,e&&e.response)switch(e.response.status){case 400:e.message="错误请求";break;case 401:e.message="未授权，请重新登录";break;case 403:e.message="拒绝访问";break;case 404:e.message="请求错误,未找到该资源";break;case 405:e.message="请求方法未允许";break;case 408:e.message="请求超时";break;case 500:e.message="服务器端出错";break;case 501:e.message="网络未实现";break;case 502:e.message="网络错误";break;case 503:e.message="服务不可用";break;case 504:e.message="网络超时";break;case 505:e.message="http版本不支持该请求";break;default:e.message="连接错误"+e.response.status}else e.message="连接到服务器失败了~";return"pc"===deviceType?_elementUi.Message.error(e.message):(0,_vant.Notify)({type:"danger",message:e.message}),Promise.reject(e)})}}]),s}();function loadingClose(){setTimeout(function(){if(0===requestCount)if("pc"===deviceType){if(0!==loadingInstanceArr.length){for(var e=0,s=loadingInstanceArr.length;e<s;e++)loadingInstanceArr[e].close();loadingInstanceArr=[]}}else _vant.Toast.clear()},10)}